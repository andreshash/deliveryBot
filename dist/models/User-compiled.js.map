{"version":3,"sources":["User.js"],"names":[],"mappings":"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","file":"User-compiled.js","sourcesContent":["'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});var _index=require('../actions/index');var _Consumer=require('../models/Consumer');var _Consumer2=_interopRequireDefault(_Consumer);var _requestPromise=require('request-promise');var _requestPromise2=_interopRequireDefault(_requestPromise);var _config=require('config');var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var FACEBOOK_GRAPH=_config2.default.get('FACEBOOK_GRAPH');var User=Parse.Object.extend('User',{initialize:function initialize(attrs,options){//console.log('new user');\n//console.log();\n//console.log(options);\n},signUpWithFacebookData:function signUpWithFacebookData(data){var facebookId=this.get('facebookId');return this.signUp(Object.assign(data,{username:facebookId.toString(),password:facebookId.toString()})).fail(function(error){console.log('Error code: '+error.message);});},registered:function registered(){return new Parse.Query('User').equalTo('facebookId',this.get('facebookId')).first().fail(function(error){console.log('Error code: '+error.message);});},createConsumer:function createConsumer(store,recipientId,conversationToken){var consumer=new _Consumer2.default({conversationId:parseInt(recipientId),conversationToken:conversationToken});consumer.setUser(this);return consumer.save().then(function(){return consumer.saveInStore(store,recipientId);});},saveInStore:function saveInStore(store,recipientId){return store.dispatch((0,_index.setUser)(recipientId,this)).fail(function(error){console.log('Error code: '+error.message);});}},{loadInStore:function loadInStore(store,recipientId){return store.dispatch((0,_index.loadUser)(recipientId)).fail(function(error){console.log('Error code: '+error.message);});},getFacebookUserData:function getFacebookUserData(facebookId,conversationToken){return(0,_requestPromise2.default)({uri:FACEBOOK_GRAPH+facebookId,qs:{access_token:conversationToken,fields:'first_name,last_name,locale,timezone,gender'},method:'GET'}).then(function(body){return JSON.parse(body);}).catch(function(error){console.log('error');console.log(error);});},createUser:function createUser(store,recipientId,facebookId,conversationToken){var user=new User({facebookId:parseInt(facebookId)});return User.getFacebookUserData(facebookId,conversationToken).then(function(data){delete data.id;return user.signUpWithFacebookData(data).then(function(){return user.saveInStore(store,recipientId);});});}});exports.default=User;"]}