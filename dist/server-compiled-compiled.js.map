{"version":3,"sources":["server-compiled.js"],"names":[],"mappings":"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","file":"server-compiled-compiled.js","sourcesContent":["'use strict';\n\nvar _config = require('config');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _node = require('parse/node');\n\nvar _node2 = _interopRequireDefault(_node);\n\nvar _express = require('express');\n\nvar _express2 = _interopRequireDefault(_express);\n\nvar _path = require('path');\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _bodyParser = require('body-parser');\n\nvar _bodyParser2 = _interopRequireDefault(_bodyParser);\n\nvar _request = require('request');\n\nvar _request2 = _interopRequireDefault(_request);\n\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n}\n\nvar PARSE_APP_ID = process.env.PARSE_APP_ID ? process.env.PARSE_APP_ID : _config2.default.get('PARSE_APP_ID');\n\nvar PARSE_SERVER_URL = process.env.PARSE_SERVER_URL ? process.env.PARSE_SERVER_URL : _config2.default.get('PARSE_SERVER_URL');\n\nvar SERVER_URL = process.env.SERVER_URL ? process.env.SERVER_URL : _config2.default.get('SERVER_URL');\n\n_node2.default.initialize(PARSE_APP_ID);\n_node2.default.serverURL = PARSE_SERVER_URL;\nglobal.Parse = _node2.default;\n\nvar app = (0, _express2.default)();\napp.set('port', process.env.PORT || 8000);\napp.set('view engine', 'ejs');\napp.use(_bodyParser2.default.urlencoded({ extended: true }));\napp.use(_express2.default.static('public'));\n\napp.get('/creditcard', function (req, res) {\n    res.sendFile(_path2.default.join(__dirname + '/views/cardForm.html'));\n});\n\napp.post('/registerCreditCard', function (req, res) {\n    var User = _node2.default.Object.extend('User');\n    var Consumer = _node2.default.Object.extend('Consumer');\n    var consumerID = req.body['consumerID'];\n    var data = req.body;\n\n    console.log('registerCreditCard');\n\n    new _node2.default.Query(Consumer).get(consumerID).then(function (consumer) {\n        if (consumer) {\n            new _node2.default.Query(User).get(consumer.get('user').id).then(function (user) {\n                var username = user.get('username');\n                var recipientId = user.get('facebookId');\n                _node2.default.User.logIn(username, username, {\n                    success: function success(userData) {\n                        var expiry = data['expiry'].replace(/\\s+/g, \"\").split('/');\n\n                        _request2.default.post({\n                            url: PARSE_SERVER_URL + '/functions/addCreditCard',\n                            headers: {\n                                'Content-Type': 'text/plain;charset=UTF-8',\n                                'X-Parse-Application-Id': PARSE_APP_ID,\n                                'X-Parse-Session-Token': userData.getSessionToken()\n                            },\n                            json: { \"number\": data['number'].replace(/\\s+/g, \"\"),\n                                \"verificationNumber\": data['CCV'],\n                                \"expirationMonth\": expiry[0],\n                                \"expirationYear\": expiry[1],\n                                \"holderName\": data['first-name'] + ' ' + data['last-name']\n                            }\n                        }, function callback(error, response, body) {\n                            if (!error && response.statusCode == 200) {\n\n                                _request2.default.post({\n                                    url: SERVER_URL + 'CreditCardRegistered',\n                                    json: { \"recipientId\": recipientId }\n                                });\n                            } else {\n                                console.log(response.statusCode);\n                                console.log('error');\n                                console.log(error);\n                            }\n                        });\n                    },\n                    error: function error(user, _error) {\n                        console.log('error');\n                        console.log(_error);\n                    }\n                });\n            });\n\n            res.sendFile(_path2.default.join(__dirname + '/views/cardRegistered.html'));\n        }\n    }, function (object, error) {\n        console.log(error);\n    });\n});\n\nmodule.exports = { app: app, Parse: _node2.default };\n\n//# sourceMappingURL=server-compiled.js.map"]}